## 검색평가

#### 개요
- 검색 품질을 정량적으로 평가할 수 있는 기능입니다
- 검색어 -> 정답셋 구축 후 Precision, Recall 평가하도록 구현하였고, LLM 을 통해 구축에 도움을 받을 수 있습니다.
- Precision, Recall 로 평가하도록 한 이유는 아래와 같습니다
  - 유저 데이터가 없으므로, CTR 등 유저 데이터 기반 평가가 불가합니다
  - NDCG 처럼 검색된 문서에 연관도 점수를 차등 부여하는 방식은, 짧은 키워드 나열 위주인 상품명 데이터에서는 효과적인 연관도 차등 부여가 힘들다고 판단하였습니다
- 참고 문서
  - https://www.elastic.co/search-labs/blog/evaluating-search-relevance-part-2 (LLM 을 통한 연관도 평가)

#### 평가셋 생성
- LLM 을 통해 쿼리 -> 정답셋을 자동으로 생성할 수 있게 하였습니다
- 아래 프롬프트로 쿼리 생성 후, 바이그램/형태소/벡터 방식으로 질의해서 가능한 많은 정답 후보군을 가져오도록 하였습니다(정답 후보군은 적당한 개수의 후보군을 가진 쿼리들만 추천되도록 처리)
  
  - 프롬프트
    ```
    당신은 이커머스 검색 전문가입니다.
    다음 검색 쿼리에 대해 {PRODUCT_COUNT}개 상품의 관련성을 평가해주세요.
    
    검색 쿼리: "{QUERY}"
    
    평가할 상품들:
    {PRODUCT_LIST}
    
    평가 기준:
    1. 상품명이 검색 쿼리와 얼마나 관련성이 있는가?
    2. 상품 스펙이 검색 의도와 부합하는가?
    3. 사용자가 이 쿼리로 찾을 가능성이 높은 상품인가?
    
    응답 형식 (JSON 배열):
    ```json
    [
      {
        "productId": "상품ID",
        "isRelevant": true,
        "reason": "평가 이유",
        "confidence": 0.95
      },
      {
        "productId": "상품ID",
        "isRelevant": false,
        "reason": "평가 이유",
        "confidence": 0.80
      }
    ]
    ```
    
    주의사항: 모든 {PRODUCT_COUNT}개 상품에 대해 순서대로 평가 결과를 제공해야 합니다.
    다른 텍스트나 마크다운은 포함하지 말고 JSON 배열만 응답해주세요. 
    ```
  
- 생성시 아래와 같이 생성된 후보군을 확인할 수 있고, 수동으로 라벨링 변경이 가능합니다
  
- 검색 평가 페이지에서, 아래와 같이 평가 실행 및 평가 상세 정보 확인이 가능합니다

- 수작업 후 개인적 평가를 통해 아래와 같은 검색 개선점을 파악할 수 있었습니다
